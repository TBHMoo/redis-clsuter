#缓存的收益和成本
- 收益
```shell script
加速读写= 优化用户体验 ,缓存通常是全内存的, 而存储层通常读写性能不够强
降低后端负载
```
- 成本
```shell script
数据不一致性，缓存层和存储层存在一定时间窗口的不一致,时间窗口和策略有关
代码维护成本
运维成本， 比如 redis cluster
```

#缓存使用场景
```shell script
计算量大的查询，多表关联和分组查询
加速请求响应，比如秒杀是的页面
```

#缓存更新策略
```shell script
计算机的存储 规律,速度越快，存储空间越小。
CPU多级缓存 L1,L2,L3
内存，磁盘 
缓存层和存储层
redis 和 mysql

好钢用在刀刃上嘛，内存中一般用于热数据

redis 对数据一致性要求从低到高
1）LRU/LFU/FIFO 算法剔除  被动删除一致性最低（maxmemory-policy 内存最大值后剔除策略）
LRU  如果一个数据在最近一段时间没有被访问到，那么在将来它被访问的可能性也很小(基于时间)
LFU  如果一个数据在最近一段时间内使用次数很少，那么在将来一段时间内被使用的可能性也很小(基于频率)
FIFO  如果一个数据先进缓存，那么应该先出缓存
2）设置过期时间   一致性一般，存在一定时间窗口
3）主动更新       一致性最高，维护成本最高

制定缓存策略时，根据业务对一致性的要求来选择
高一致性要求业务，使用主动更新策略，和过期时间。如果主动更新失败，也可以用过期时间来删除缓存数据

```

#缓存粒度控制
全部属性，还是部分属性？这是一个问题

adidas 商品属性缓存
缓存粒度过小，维护成本巨大，线上经常出现一致性问题 人工成本很高

# 穿透优化
> 缓存穿透是指查询一个缓存层和存储层都不存在的数据。 

1.缓存空对象 短有效期以防恶意攻击占用过多内存

2.布隆过滤器拦截 这种方法适用于数据命中不高、数据相对固定、实时性低
 
 # 无底洞优化
 用一句通俗的话总结就是，更多的节点不代表更高的性能，所谓“无底
 洞”就是说投入越多不一定产出越多
 
 ·客户端一次批量操作会涉及多次网络操作，也就意味着批量操作会随
 着节点的增多，耗时会不断增大。
 ·网络连接数变多，对节点的性能也有一定影响。
 ----
     | 方案          |   优点         |    缺点       |   网络IO          |
     | ------------- |  ------------- | ------------- | -------------     |
     | 串行命令      | 1）编程               |               |                   |
     | 串行命令      |    fffff           |               |                   |
     | 串行IO        | Content Cell  |               |                   |
     | 并行IO        | Content Cell  |               |                   |
     | hsah_tag      | Content Cell  |               |                   |
     | Content Cell  | Content Cell  |               |                   |
 ----
 
 
# 雪崩优化
缓存高可用
redis sentinel / redis cluster 
依赖隔离组件为后端限流并降级
Java依赖隔离工具?Hystrix（https://github.com/netflix/hystrix）

# 热点key重建优化
1）互斥锁 setnx
2) 永远不过期

缓存使用目标
1）加快用户访问速度
2）降低后端负载
3）保证数据尽可能一致






